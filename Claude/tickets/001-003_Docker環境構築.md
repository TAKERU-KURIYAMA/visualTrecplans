# チケット001-003: Docker環境構築

## 概要
開発環境用のDocker Compose設定を作成し、ワンコマンドで開発環境を起動できるようにする

## 優先度
高

## 親チケット
001_プロジェクト初期セットアップ

## 詳細タスク

### 1. docker-compose.yml作成
- [ ] サービス定義
  ```yaml
  version: '3.8'
  services:
    frontend:
      build: ./frontend
      ports: ["3000:3000"]
      volumes:
        - ./frontend:/app
        - /app/node_modules
      environment:
        - NODE_ENV=development
    
    backend:
      build: ./backend
      ports: ["8080:8080"]
      volumes:
        - ./backend:/app
      environment:
        - GO_ENV=development
      depends_on:
        - postgres
    
    postgres:
      image: postgres:14-alpine
      ports: ["5432:5432"]
      environment:
        - POSTGRES_USER=trecplans
        - POSTGRES_PASSWORD=password
        - POSTGRES_DB=trecplans_dev
      volumes:
        - postgres_data:/var/lib/postgresql/data
  
  volumes:
    postgres_data:
  ```

### 2. Dockerfileの作成
- [ ] frontend/Dockerfile
  - Node.js 18ベース
  - 開発用ホットリロード対応
- [ ] backend/Dockerfile
  - Go 1.21ベース
  - Air（ホットリロード）導入

### 3. 開発用設定ファイル
- [ ] .dockerignore作成
- [ ] docker-compose.override.yml（ローカル設定用）
- [ ] データベース初期化スクリプト

### 4. 開発用ヘルパースクリプト
- [ ] scripts/dev-setup.sh
  - 初回セットアップ用
- [ ] scripts/dev-start.sh
  - 開発環境起動
- [ ] scripts/dev-reset.sh
  - データベースリセット

### 5. ヘルスチェック設定
- [ ] 各サービスのヘルスチェック定義
- [ ] 起動順序の制御

## 受け入れ条件
- `docker-compose up`で全サービスが起動すること
- ホットリロードが機能すること
- データベースが正しく初期化されること
- 各サービスが相互に通信できること

## 見積もり工数
3時間

## 完了報告
### 作業日時: 2025-07-10

### 実施内容
1. **docker-compose.yml作成**
   - フロントエンド、バックエンド、PostgreSQL、Adminerの4サービス構成
   - ヘルスチェック機能付きで依存関係を適切に管理
   - 開発用ネットワーク設定とボリューム永続化

2. **Dockerfileの作成**
   - **frontend/Dockerfile.dev**: Node.js 18ベース、ホットリロード対応
   - **backend/Dockerfile.dev**: Go 1.21ベース、Air（ホットリロード）内蔵

3. **開発用設定ファイル**
   - **.dockerignore**: 不要ファイルの除外設定
   - **docker-compose.override.yml**: 個人設定用（Git除外）
   - **scripts/init-db.sql**: PostgreSQL初期化スクリプト

4. **開発効率化ヘルパースクリプト**
   - **dev-setup.sh**: 初回セットアップ自動化（環境変数、ビルド、DB初期化）
   - **dev-start.sh**: 開発環境起動とヘルスチェック
   - **dev-reset.sh**: 環境リセット（データ削除、再構築）

5. **サービス間連携設定**
   - 各サービスのヘルスチェック実装
   - 適切な起動順序制御（postgres → backend → frontend）
   - サービス間通信の設定

### 技術的特徴
- **ホットリロード**: フロントエンド（npm）、バックエンド（Air）
- **データベース管理**: Adminer統合でGUI操作可能
- **開発者体験**: ワンコマンドセットアップ、カラー出力、詳細ログ
- **環境分離**: 個人設定とチーム設定の分離

### 成果物
- `docker-compose up`で全サービス起動可能
- ホットリロード機能で開発効率向上
- PostgreSQLの自動初期化とデータ永続化
- 包括的なヘルスチェックと起動確認

### 未消化作業
なし - 全てのタスクを完了